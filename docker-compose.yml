version: '3.1'

services:
    mysql:
        image: mysql:8.0.3
        restart: always
        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: airflow
            MYSQL_USER: airflow
            MYSQL_PASSWORD: airflow

    rabbitmq:
        image: rabbitmq:3.7.3
        hostname: rabbitmq
        restart: always
        environment:
            RABBITMQ_DEFAULT_USER: rabbitmq
            RABBITMQ_DEFAULT_PASS: rabbitmq

    webserver:
        image: rdonnarumma/airflow-gcp:latest
        restart: always
        depends_on:
            - mysql
            - rabbitmq
        ports:
            - "8080:8080"
        environment:
            - EXECUTOR=Celery
        command: webserver
        #healthcheck:
        #test: ["CMD-SHELL", "[ -f /usr/local/airflow/airflow-webserver.pid ]"]
        #interval: 30s
        #timeout: 30s
        #retries: 3
